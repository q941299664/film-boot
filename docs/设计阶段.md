# 项目设计阶段文档

## 1. 引言

本文档旨在详细描述电影票务系统的设计阶段，包括数据库设计、系统目标、总体设计、逻辑结构设计等方面。

## 2. 数据库需求分析

根据业务需求，系统设计了以下数据库表：

1. 用户表（`sys_user_tb`）
2. 角色表（`sys_role_tb`）
3. 权限表（`sys_permission_tb`）
4. 用户_角色表（`sys_user_role_tb`）
5. 角色_权限表（`sys_role_permission_tb`）
6. 系统字典表（`sys_dict_tb`）
7. 系统字典数据表（`sys_dict_data_tb`）

每个表都有其特定的字段，用于存储相关信息。

## 3. 系统目标

本系统的设计主要实现以下目标：

### 3.1 人性化设计

- 前台：用户注册、用户登录、查询影片、影片打分、在线选座、在线订票、个人中心。
- 后台：管理员登录、后台用户管理、影片管理、场次管理、放映厅管理、评论管理、订单管理。

## 4. 系统概要设计

### 4.1 总体设计

#### 4.1.1 处理流程

#### 普通用户

1. 打开系统，进入系统前台首页界面，可以进行用户注册、用户登录、查询影片。
2. 用户登录后，可以进行影片打分、在线选座、在线订票、查看个人中心。
3. 用户可以随时退出系统。

#### 管理员

1. 打开系统，进入系统登录界面。
2. 通过验证后，进入系统管理主界面。
3. 管理员可以进行用户管理、影片管理、场次管理、放映厅管理、评论管理、订单管理。
4. 管理员可以随时退出系统。

### 4.2 逻辑结构设计

### 逻辑结构设计

1. **用户与角色关系**
    - 一个用户（`sys_user_tb`）可以有多个角色（`sys_role_tb`）。
    - 一个角色可以被多个用户所共享。

2. **角色与权限关系**
    - 一个角色可以包含多个权限（`sys_permission_tb`）。
    - 一个权限可以被多个角色共享。

3. **用户与用户角色关系**
    - 一个用户可以被分配多个角色（`sys_role_tb`）。
    - 一个角色可以被多个用户所拥有。

4. **角色与角色权限关系**
    - 一个角色可以包含多个权限（`sys_permission_tb`）。
    - 一个权限可以被多个角色所拥有。

5. **系统字典与字典数据关系**
    - 一个系统字典（`sys_dict_tb`）可以包含多个字典数据（`sys_dict_data_tb`）。
    - 一个字典数据只能属于一个系统字典。

6. **用户与评论关系**
    - 一个用户可以发布多条评论（`comment_tb`）。
    - 一条评论只能由一个用户发布。

7. **电影与评论关系**
    - 一部电影可以被多个用户评论（`comment_tb`）。
    - 一条评论只能关联到一部电影。

8. **放映厅与场次关系**
    - 一个放映厅（`cinema_hall_tb`）可以有多个场次（`session_tb`）。
    - 一个场次只能属于一个放映厅。

9. **场次与订单详情关系**
    - 一个场次（`session_tb`）可以有多个订单详情（`order_detail_tb`）。
    - 一个订单详情只能属于一个场次。

10. **订单与订单详情关系**
    - 一个订单（`order_tb`）可以包含多个订单详情（`order_detail_tb`）。
    - 一个订单详情只能属于一个订单。

## 5. 数据项和数据结构

根据表设计，定义以下数据项和数据结构：

### 用户表（`sys_user_tb`）

- `id`（用户ID）: 主键，自增长的唯一标识符。
- `username`（用户名）: 用户的登录名。
- `password`（密码）: 用户的登录密码。
- `email`（电子邮箱）: 用户的电子邮箱地址。
- `deleted`（删除标志）: 逻辑删除标志，表示用户是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新用户信息的管理员或用户的ID。
- `update_time`（更新时间）: 记录用户信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建用户的管理员或用户的ID。
- `create_time`（创建时间）: 记录用户的创建时间。

### 角色表（`sys_role_tb`）

- `id`（角色ID）: 主键，自增长的唯一标识符。
- `parent_id`（上一级角色ID）: 表示角色的上一级角色，可以是其他角色的ID。
- `name`（角色名称）: 角色的名称，用于标识角色的唯一性。
- `deleted`（删除标志）: 逻辑删除标志，表示角色是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新角色信息的管理员的ID。
- `update_time`（更新时间）: 记录角色信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建角色的管理员的ID。
- `create_time`（创建时间）: 记录角色的创建时间。

### 权限表（`sys_permission_tb`）

- `id`（权限ID）: 主键，自增长的唯一标识符。
- `name`（权限名称）: 权限的名称，用于标识权限的唯一性。
- `parent_id`（上一级权限ID）: 表示权限的上一级权限，可以是其他权限的ID。
- `type`（权限类型）: 表示权限的类型，可能是菜单、按钮等。
- `uri`（权限字符串）: 表示权限的具体操作路径。
- `meta`（权限元数据）: 存储权限的元数据信息。
- `sort`（排序依据字段）: 用于排序权限的显示顺序。
- `deleted`（删除标志）: 逻辑删除标志，表示权限是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新权限信息的管理员的ID。
- `update_time`（更新时间）: 记录权限信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建权限的管理员的ID。
- `create_time`（创建时间）: 记录权限的创建时间。

### 用户_角色表（`sys_user_role_tb`）

- `id`（用户角色ID）: 主键，自增长的唯一标识符。
- `user_id`（用户ID）: 关联用户表的ID。
- `role_id`（角色ID）: 关联角色表的ID。
- `deleted`（删除标志）: 逻辑删除标志，表示用户角色关联是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新用户角色关联的管理员的ID。
- `update_time`（更新时间）: 记录用户角色关联最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建用户角色关联的管理员的ID。
- `create_time`（创建时间）: 记录用户角色关联的创建时间。

### 角色_权限表（`sys_role_permission_tb`）

- `id`（角色_权限ID）: 主键，自增长的唯一标识符。
- `role_id`（角色ID）: 关联角色表的ID。
- `permission_id`（权限ID）: 关联权限表的ID。
- `deleted`（删除标志）: 逻辑删除标志，表示角色权限关联是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新角色权限关联的管理员的ID。
- `update_time`（更新时间）: 记录角色权限关联最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建角色权限关联的管理员的ID。
- `create_time`（创建时间）: 记录角色权限关联的创建时间。

### 系统字典表（`sys_dict_tb`）

- `id`（字典ID）: 主键，自增长的唯一标识符。
- `name`（字典名称）: 字典的名称，用于标识字典的唯一性。
- `code`（字典编码）: 字典的编码，用于标识字典的唯一性。
- `sort`（排序依据字段）: 用于排序字典的显示顺序。
- `deleted`（删除标志）: 逻辑删除标志，表示字典是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新字典信息的管理员的ID。
- `update_time`（更新时间）: 记录字典信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建字典的管理员的ID。
- `create_time`（创建时间）: 记录字典的创建时间。

### 系统字典数据表（`sys_dict_data_tb`）

- `id`（字典数据ID）: 主键，自增长的唯一标识符。
- `parent_id`（上一级字典数据ID）: 表示字典数据的上一级字典数据，可以是其他字典数据的ID。
- `code`（字典编码）: 字典数据的编码，用于标识字典数据的唯一性。
- `label`（字典标签）: 字典数据的标签，用于显示的名称。
- `value`（字典键值）: 字典数据的键值，可能是具体数值或字符串。
- `css_style`（样式属性）: 字典数据的样式属性。
- `list_style`（表格回显样式）: 字典数据在表格中的回显样式。
- `is_default`（是否默认）: 标识字典数据是否为默认值。
- `remark`（备注）: 字典数据的备注信息。
- `sort`（排序依据字段）: 用于排序字典数据的显示顺序。
- `deleted`（删除标志）: 逻辑删除标志，表示字典数据是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新字典数据信息的管理员的ID。
- `update_time`（更新时间）: 记录字典数据信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建字典数据的管理员的ID。
- `create_time`（创建时间）: 记录字典数据的创建时间。

### 放映厅表（`cinema_hall_tb`）

- `id`（放映厅ID）: 主键，自增长的唯一标识符。
- `name`（放映厅名称）: 放映厅的名称，用于标识放映厅的唯一性。
- `capacity`（放映厅容量）: 放映厅的座位容量。
- `cinema_id`（所属影院ID）: 关联影院表的ID，表示该放映厅属于哪个影院。
- `deleted`（删除标志）: 逻辑删除标志，表示放映厅是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新放映厅信息的管理员的ID。
- `update_time`（更新时间）: 记录放映厅信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建放映厅的管理员的ID。
- `create_time`（创建时间）: 记录放映厅的创建时间。

### 场次表（`session_tb`）

- `id`（场次ID）: 主键，自增长的唯一标识符。
- `hall_id`（放映厅ID）: 关联放映厅表的ID，表示该场次在哪个放映厅。
- `movie_id`（电影ID）: 关联电影表的ID，表示放映的电影。
- `start_time`（电影开始时间）: 电影放映的开始时间。
- `price`（电影票售价）: 电影票的售价。
- `remaining_seats`（剩余座位数）: 该场次剩余的座位数。
- `status`（场次状态）: 表示场次的状态，可能是正在放映、已结束等。
- `deleted`（删除标志）: 逻辑删除标志，表示场次是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新场次信息的管理员的ID。
- `update_time`（更新时间）: 记录场次信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建场次的管理员的ID。
- `create_time`（创建时间）: 记录场次的创建时间。

### 评论表（`comment_tb`）

- `id`（评论ID）: 主键，自增长的唯一标识符。
- `user_id`（用户ID）: 关联用户表的ID，表示评论的用户。
- `content`（评论内容）: 用户对电影的评论内容。
- `movie_id`（电影ID）: 关联电影表的ID，表示被评论的电影。
- `time`（评论时间）: 用户评论的时间。
- `rating`（评分）: 用户对电影的评分。
- `deleted`（删除标志）: 逻辑删除标志，表示评论是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新评论信息的管理员的ID。
- `update_time`（更新时间）: 记录评论信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建评论的管理员的ID。
- `create_time`（创建时间）: 记录评论的创建时间。

### 订单表（`order_tb`）

- `id`（订单ID）: 主键，自增长的唯一标识符。
- `user_id`（用户ID）: 关联用户表的ID，表示下单的用户。
- `session_id`（场次ID）: 关联场次表的ID，表示用户下单的场次。
- `seat_info`（电影票座位信息）: 用户订购的电影票座位信息。
- `status`（订单状态）: 订单的状态，可能是待支付、已支付等。
- `price`（订单价格）: 订单的总价格。
- `pay_time`（订单支付时间）: 订单支付的时间。
- `deleted`（删除标志）: 逻辑删除标志，表示订单是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新订单信息的管理员的ID。
- `update_time`（更新时间）: 记录订单信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建订单的管理员的ID。
- `create_time`（创建时间）: 记录订单的创建时间。

### 订单详情表（`order_detail_tb`）

- `id`（订单详情ID）: 主键，自增长的唯一标识符。
- `order_id`（订单ID）: 关联订单表的ID，表示该详情属于哪个订单。
- `hall_id`（放映厅ID）: 关联放映厅表的ID，表示该场次在哪个放映厅。
- `movie_id`（电影ID）: 关联电影表的ID，表示放映的电影。
- `start_time`（电影开始时间）: 电影放映的开始时间。
- `price`（电影票售价）: 电影票的售价。
- `remaining_seats`（剩余座位数）: 该场次剩余的座位数。
- `status`（场次状态）: 表示场次的状态，可能是正在放映、已结束等。
- `deleted`（删除标志）: 逻辑删除标志，表示订单详情是否被删除。
- `update_id`（更新者ID）: 记录最后一次更新订单详情信息的管理员的ID。
- `update_time`（更新时间）: 记录订单详情信息最后一次更新的时间。
- `create_id`（创建者ID）: 记录创建订单详情的管理员的ID。
- `create_time`（创建时间）: 记录订单详情的创建时间。

## 6. 功能设计
### 6.1 前台系统设计实现

#### 6.1.1 首页界面实现

- **功能描述：** 显示系统首页，用户可以进行注册、登录、查询影片等操作。

- **实现步骤：**
   1. 设计首页界面，包括导航栏、搜索框等元素。
   2. 添加用户注册、登录按钮，以及查询影片的搜索框。
   3. 用户点击注册按钮后，跳转至注册页面；点击登录按钮后，跳转至登录页面。
   4. 用户在搜索框中输入关键字，系统展示相关电影信息。

#### 6.1.2 用户注册功能实现

- **功能描述：** 允许用户进行注册，提供用户名、密码、邮箱等注册信息。

- **实现步骤：**
   1. 用户点击注册按钮后，进入注册页面。
   2. 用户填写必要的注册信息，包括用户名、密码、邮箱等。
   3. 系统验证用户输入的信息合法性，包括用户名是否已存在、密码强度等。
   4. 注册成功后，系统创建用户账户，并跳转至登录页面。

#### 6.1.3 用户登录功能实现

- **功能描述：** 允许已注册用户进行登录。

- **实现步骤：**
   1. 用户在登录页面输入用户名和密码。
   2. 系统验证用户输入的用户名和密码是否匹配已注册用户信息。
   3. 登录成功后，系统创建用户会话，并跳转至用户个人中心页面。
   4. 登录失败时，系统给予相应提示。

#### 6.1.4 影片信息查询实现

- **功能描述：** 用户可以通过关键字搜索查询电影信息。

- **实现步骤：**
   1. 用户在首页搜索框中输入关键字。
   2. 系统根据关键字查询电影数据库，返回匹配的电影信息列表。
   3. 用户点击查询结果，进入电影详情页面。

#### 6.1.5 影片详情实现

- **功能描述：** 展示电影的详细信息，包括演职人员、时长、类型、评分等。

- **实现步骤：**
   1. 系统接收用户点击的电影，查询电影数据库获取详细信息。
   2. 展示电影的演职人员、时长、类型、评分等相关信息。
   3. 用户可以进行电影评分、查看评论等操作。

#### 6.1.6 用户评论评分实现

- **功能描述：** 用户可以对电影进行评论和评分。

- **实现步骤：**
   1. 用户在电影详情页面可以看到其他用户的评论，并进行自己的评论。
   2. 系统接收用户的评论和评分，存储到评论表中。
   3. 用户评论后，系统更新电影的评分信息。

#### 6.1.7 用户订座位实现

- **功能描述：** 用户可以在线选座位。

- **实现步骤：**
   1. 在电影详情页面，用户可以选择观影时间，进入选座位页面。
   2. 系统展示放映厅座位图，用户可以选择空闲座位。
   3. 用户确认座位后，系统生成订单。

#### 6.1.8 用户下单实现

- **功能描述：** 用户可以在线订票。

- **实现步骤：**
   1. 用户在选座位页面确认座位后，点击下单按钮。
   2. 系统生成订单，包括订单号、座位信息、价格等。
   3. 用户选择支付方式，完成支付。

#### 6.1.9 用户个人中心实现

- **功能描述：** 用户可以查看个人信息、订单历史等。

- **实现步骤：**
   1. 用户登录后，可以进入个人中心页面。
   2. 系统展示用户的个人信息，包括用户名、订单历史等。
   3. 用户可以查看订单详情、修改个人信息等。

### 6.2 后台系统设计实现

#### 6.2.1 管理员登录实现

- **功能描述：** 管理员可以通过用户名和密码登录后台系统。

- **实现步骤：**
   1. 管理员在登录页面输入用户名和密码。
   2. 系统验证管理员输入的用户名和密码是否匹配后台管理员信息。
   3. 登录成功后，系统创建管理员会话，并跳转至后台管理主页面。
   4. 登录失败时，系统给予相应提示。

#### 6.2.2 后台主页面实现

- **功能描述：** 后台主页面展示各个管理模块的入口，包括用户管理、影片管理、场次管理等。

- **实现步骤：**
   1. 管理员登录后，进入后台管理主页面。
   2. 页面展示各个管理模块的入口，管理员可以点击进入相应模块。

#### 6.2.3 用户管理实现

- **功能描述：** 管理员可以对用户进行管理，包括查看用户信息、修改用户信息、禁用用户等。

- **实现步骤：**
   1. 管理员进入用户管理模块。
   2. 可以查看用户列表，包括用户名、注册时间等信息。
   3. 管理员可以点击用户详情，修改用户信息

，禁用用户等。

#### 6.2.4 影片管理实现

- **功能描述：** 管理员可以对电影进行管理，包括添加新电影、修改电影信息、下架电影等。

- **实现步骤：**
   1. 管理员进入影片管理模块。
   2. 可以查看电影列表，包括电影名称、上映时间等信息。
   3. 管理员可以点击添加新电影，填写电影信息并保存。
   4. 管理员可以点击电影详情，修改电影信息，下架电影等。

#### 6.2.5 影院管理实现

- **功能描述：** 管理员可以对影院进行管理，包括添加新影院、修改影院信息等。

- **实现步骤：**
   1. 管理员进入影院管理模块。
   2. 可以查看影院列表，包括影院名称、地址等信息。
   3. 管理员可以点击添加新影院，填写影院信息并保存。
   4. 管理员可以点击影院详情，修改影院信息等。

#### 6.2.6 放映厅管理实现

- **功能描述：** 管理员可以对放映厅进行管理，包括添加新放映厅、修改放映厅信息等。

- **实现步骤：**
   1. 管理员进入放映厅管理模块。
   2. 可以查看放映厅列表，包括放映厅名称、容量等信息。
   3. 管理员可以点击添加新放映厅，填写放映厅信息并保存。
   4. 管理员可以点击放映厅详情，修改放映厅信息等。

#### 6.2.7 场次管理实现

- **功能描述：** 管理员可以对电影场次进行管理，包括添加新场次、修改场次信息等。

- **实现步骤：**
   1. 管理员进入场次管理模块。
   2. 可以查看场次列表，包括电影名称、放映厅、开始时间等信息。
   3. 管理员可以点击添加新场次，选择电影、放映厅、时间等信息并保存。
   4. 管理员可以点击场次详情，修改场次信息等。

#### 6.2.8 评论管理实现

- **功能描述：** 管理员可以查看用户的评论，包括删除不当评论等。

- **实现步骤：**
   1. 管理员进入评论管理模块。
   2. 可以查看评论列表，包括用户、电影、评论内容等信息。
   3. 管理员可以点击删除不当评论。

#### 6.2.9 订单管理实现

- **功能描述：** 管理员可以查看用户订单，包括订单详情、修改订单状态等。

- **实现步骤：**
   1. 管理员进入订单管理模块。
   2. 可以查看订单列表，包括用户、订单状态、下单时间等信息。
   3. 管理员可以点击订单详情，查看订单详细信息。
   4. 管理员可以修改订单状态，例如确认支付、取消订单等。
